<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Terminal Notes</title>
    <meta name="description" content="Terminal-style notes browser on GitHub Pages" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="stylesheet" href="./style.css" />
    <!-- 防止模式闪烁：在页面渲染前设置正确的模式 -->
    <script>
      (function() {
        const saved = localStorage.getItem('tn_mode') || 'mode-light';
        const isLight = saved === 'mode-light';
        const root = document.documentElement;
        root.classList.toggle('mode-light', isLight);
        root.classList.toggle('mode-dark', !isLight);
      })();
    </script>
    <!-- 版本控制：修改此版本号可强制刷新所有缓存 -->
    <script>
      const CACHE_VERSION = '3.1.2';
    </script>
  </head>
  <body>
  <button id="header-btn" class="header-btn" title="切换明暗" aria-label="toggle theme">🌗</button>
  <div id="app" class="theme-retro">
      <div id="terminal" role="region" aria-label="terminal">
        <div class="term-header">
          <div class="dots">
            <span class="dot red"></span>
            <span class="dot yellow"></span>
            <span class="dot green"></span>
          </div>
          <div class="title">~/notes — Terminal</div>
          <div class="spacer"></div>
        </div>
    <div id="output" class="output" aria-live="polite"></div>
      </div>
      <noscript>
        请启用 JavaScript 以使用终端式站点。
      </noscript>
    </div>

  <script src="https://cdn.jsdelivr.net/npm/marked@16.2.1/lib/marked.umd.js"></script integrity="sha384-9aoLb5ZpEzFGqhQNzuCS8VCCm0y87jTA/8/JYWm+QbEDi4zL0NB9niGI/1CBohEF" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.6/dist/purify.min.js"></script integrity="sha384-JEyTNhjM6R1ElGoJns4U2Ln4ofPcqzSsynQkmEc/KGy6336qAZl70tDLufbkla+3" crossorigin="anonymous">
  <script src="./scripts/loader.js?v=${CACHE_VERSION}"></script>
    <!-- 动态加载所有命令模块和主程序，使用版本号防止缓存 -->
    <script>
      const scripts = [
        './commands/index.js',
        './commands/help.js',
        './commands/base.js',
        './commands/file.js',
        './commands/search.js',
        './commands/config.js',
        './commands/cat.js',
        './commands/cowsay.js',
        './commands/figlet.js',
        './commands/fortune.js',
        './commands/date.js',
        './commands/whoami.js',
        './commands/uname.js',
        './commands/wc.js',
        './terminal.js'
      ];

      // Load scripts sequentially using shared loader
      (function() {
        if (!window.loadScript) {
          console.error('loader not available');
          return;
        }
        scripts.reduce((p, src) => p.then(() => window.loadScript({ src: `${src}?v=${CACHE_VERSION}` })), Promise.resolve())
          .catch((err) => console.error('Script load error:', err));
      })();
    </script>
    <!-- 页面加载完成标记 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('loaded');
      });
    </script>
  </body>
  </html>
